mport re
import sys

def extract_move_block(log: str, gameid: str, move_number: int):
    # Regex for one move block only
    pattern = re.compile(
        rf'(^.*?INFO move: {move_number}\n'         # start at this move
        rf'.*?INFO Searching for wtime .*?for game {re.escape(gameid)}\n'  # confirm game id
        rf'.*?chess\.engine.*?>> bestmove .*?$)',   # stop at bestmove
        re.S | re.M
    )
    match = pattern.search(log)
    return match.group(1) if match else None


def main():
    if len(sys.argv) != 4:
        print(f"Usage: {sys.argv[0]} <logfile> <gameid> <move_number>")
        sys.exit(1)

    logfile = sys.argv[1]
    gameid = sys.argv[2]
    move_number = int(sys.argv[3])

    with open(logfile, "r", encoding="utf-8") as f:
        log = f.read()

    block = extract_move_block(log, gameid, move_number)
    if block:
        print(block)
    else:
        print(f"(No block found for game {gameid}, move {move_number})")


if __name__ == "__main__":
    main()

